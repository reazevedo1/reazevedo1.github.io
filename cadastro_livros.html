<!DOCTYPE html>
<html>
<head>
	<title>Cadastro de livros</title>
	<link rel="stylesheet" type="text/css" href="estiloLivro.css">
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		$(function(){ 
			$("#add_acervo").click(function(){
				let tituloLivro =$("#titulo").val();
				let descricaoLivro =$("#descricao").val();
				let generoLivro =$("#genero").val();
				let autorLivro =$("#autor").val();


				$("#acervo")
					.append(
						$("<tr>")
							.append(
								$("<td>")
									.text(tituloLivro)
								)
							.append(
								$("<td>")
									.text(descricaoLivro)
							)
							.append(
								$("<td>")
									.text(generoLivro)
							)
							.append(
								$("<td>")
									.text(autorLivro)
							)
							.append(
								$("<td>")
									.append($("<img>").attr('src', 'lixeira.png'))
								)
					);
			})

			$("#acervo").on("click","img", function(){
				alert("Apagar a linha toda");
				$(this).parents("#acervo tr").remove();
			})
			
			

			function Livro(plivro, pdescricao, pgenero, pautor{
				this.titulo = ptitulo;
				this.descricao = pdescricao;
				this.genero = pgenero;
				this.autor = pautor;
			}

			$("input[type=submit]").click(function(){
				let linhastabela = $("#acervo tbody").children();
				let leistadelivro = [];
				$.each(linhastabela, function(indice, linha){
					console.log(linha);
					let titulo = $(linha).find("td:nth-child(1)").text();
					let descricao = $(linha).find("td:nth-child(2)").text();
					let genero = $(linha).find("td:nth-child(3)").text();
					let autor = $(linha).find("td:nth-child(4)").text();
					if(titulo!==""){
					let livro = new livro(titulo, descricao, genero, autor);
					listadelivro.push(livro);
				}
			})
			let liststr = JSON.stringify(listadelivro);
			$("input[name=acervo_post]").val(listsrt);
			})
	
		});

		function sugerir(){
			var nome= document.getElementById('autor').value;
			var lista= document.getElementById('historico');
			var adicionar= true;

			var opt= document.createElement('option');

			for(i=0; i<lista.options.length; i++){
				if(nome==lista.options[i].value){
					adicionar=false;
				}
			}
			if(adicionar==true){
				opt.value=nome;
				lista.appendChild(opt);
			}

		}
	</script>
</head>
<body>

<fieldset>
	<legend>Cadastro de livros</legend>

	<input type="text" id="titulo" placeholder="Titulo"><br>
	<textarea id="descricao"></textarea> <br>
	<select id="genero">
		<option value="Romance">Romance</option>
		<option value="Drama">Drama</option>
		<option value="Terror">Terror</option>
		<option value="Ficção">Ficção</option>
		<option value="Técnico">Técnico</option>
	</select>

	<br> 
	<input type="search" id="autor" list="historico"  placeholder="Autor" >	
	<button id="add_acervo" onclick="sugerir()">Cadastrar</button>

	<datalist id="historico"> 

		  <option value="Machado de Assis"> </option>

		  <option value="Mario de Andrade"> </option>

		  <option value="Clarice Lispector"> </option>

		  <option value="Fernando Pessoa"> </option>

		  <option value="José de Alencar"> </option>

	</datalist>
	<br>
	
</fieldset>

<h1>CATÁLOGO</h1>

	<table id="acervo">
		<tr><th>Título</th><th>Descrição</th><th>Gênero</th><th>Autor</th><th></th></tr>
	</table>


	<form action="http://rafaelescalfoni.net/web/livros.php" 
		method="post">
		<input type="hidden" name="acervo_post">
		<input type="submit" class="botao" value="Salvar no BD">
	</form>
</body>
</html>
